<!DOCTYPE html>
<!--[if IE 6]><html class="ie lt-ie8"><![endif]-->
<!--[if IE 7]><html class="ie lt-ie8"><![endif]-->
<!--[if IE 8]><html class="ie ie8"><![endif]-->
<!--[if IE 9]><html class="ie ie9"><![endif]-->
<!--[if !IE]><!--> <html> <!--<![endif]-->

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"1255494d3a","applicationID":"15702971","transactionName":"e1daR0JWVV9RER9ZWkxdRxxDUVZE","queueTime":5,"applicationTime":212,"agent":""}</script>
<script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,t,n){function r(n){if(!t[n]){var o=t[n]={exports:{}};e[n][0].call(o.exports,function(t){var o=e[n][1][t];return r(o||t)},o,o.exports)}return t[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,t,n){function r(){}function o(e,t,n){return function(){return i(e,[(new Date).getTime()].concat(u(arguments)),t?null:this,n),t?void 0:this}}var i=e("handle"),a=e(2),u=e(3),c=e("ee").get("tracer"),f=NREUM;"undefined"==typeof window.newrelic&&(newrelic=f);var s=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit"],l="api-",p=l+"ixn-";a(s,function(e,t){f[t]=o(l+t,!0,"api")}),f.addPageAction=o(l+"addPageAction",!0),f.setCurrentRouteName=o(l+"routeName",!0),t.exports=newrelic,f.interaction=function(){return(new r).get()};var d=r.prototype={createTracer:function(e,t){var n={},r=this,o="function"==typeof t;return i(p+"tracer",[Date.now(),e,n],r),function(){if(c.emit((o?"":"no-")+"fn-start",[Date.now(),r,o],n),o)try{return t.apply(this,arguments)}finally{c.emit("fn-end",[Date.now()],n)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,t){d[t]=o(p+t)}),newrelic.noticeError=function(e){"string"==typeof e&&(e=new Error(e)),i("err",[e,(new Date).getTime()])}},{}],2:[function(e,t,n){function r(e,t){var n=[],r="",i=0;for(r in e)o.call(e,r)&&(n[i]=t(r,e[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;t.exports=r},{}],3:[function(e,t,n){function r(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var r=-1,o=n-t||0,i=Array(o<0?0:o);++r<o;)i[r]=e[t+r];return i}t.exports=r},{}],ee:[function(e,t,n){function r(){}function o(e){function t(e){return e&&e instanceof r?e:e?c(e,u,i):i()}function n(n,r,o){if(!p.aborted){e&&e(n,r,o);for(var i=t(o),a=v(n),u=a.length,c=0;c<u;c++)a[c].apply(i,r);var f=s[w[n]];return f&&f.push([y,n,r,i]),i}}function d(e,t){b[e]=v(e).concat(t)}function v(e){return b[e]||[]}function g(e){return l[e]=l[e]||o(n)}function m(e,t){f(e,function(e,n){t=t||"feature",w[n]=t,t in s||(s[t]=[])})}var b={},w={},y={on:d,emit:n,get:g,listeners:v,context:t,buffer:m,abort:a,aborted:!1};return y}function i(){return new r}function a(){(s.api||s.feature)&&(p.aborted=!0,s=p.backlog={})}var u="nr@context",c=e("gos"),f=e(2),s={},l={},p=t.exports=o();p.backlog=s},{}],gos:[function(e,t,n){function r(e,t,n){if(o.call(e,t))return e[t];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[t]=r,r}var o=Object.prototype.hasOwnProperty;t.exports=r},{}],handle:[function(e,t,n){function r(e,t,n,r){o.buffer([e],r),o.emit(e,t,n)}var o=e("ee").get("handle");t.exports=r,r.ee=o},{}],id:[function(e,t,n){function r(e){var t=typeof e;return!e||"object"!==t&&"function"!==t?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");t.exports=r},{}],loader:[function(e,t,n){function r(){if(!h++){var e=y.info=NREUM.info,t=l.getElementsByTagName("script")[0];if(setTimeout(f.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&t))return f.abort();c(b,function(t,n){e[t]||(e[t]=n)}),u("mark",["onload",a()],null,"api");var n=l.createElement("script");n.src="https://"+e.agent,t.parentNode.insertBefore(n,t)}}function o(){"complete"===l.readyState&&i()}function i(){u("mark",["domContent",a()],null,"api")}function a(){return(new Date).getTime()}var u=e("handle"),c=e(2),f=e("ee"),s=window,l=s.document,p="addEventListener",d="attachEvent",v=s.XMLHttpRequest,g=v&&v.prototype;NREUM.o={ST:setTimeout,CT:clearTimeout,XHR:v,REQ:s.Request,EV:s.Event,PR:s.Promise,MO:s.MutationObserver},e(1);var m=""+location,b={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-998.min.js"},w=v&&g&&g[p]&&!/CriOS/.test(navigator.userAgent),y=t.exports={offset:a(),origin:m,features:{},xhrWrappable:w};l[p]?(l[p]("DOMContentLoaded",i,!1),s[p]("load",r,!1)):(l[d]("onreadystatechange",o),s[d]("onload",r)),u("mark",["firstbyte",a()],null,"api");var h=0},{}]},{},["loader"]);</script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="Cache-Control" content="no-transform" />
    <meta name="description"  content="在使用UIKit的过程中，性能优化是永恒的话题。很多人都看过分析优化滑动性能的文章，但其中不少文章只介绍了优化方法却对背后的原理避而不谈，或者是晦涩难懂而且读者缺乏实践体验的机会。不妨思考一下下面的问题自己是否有一个清晰的认识：为什么要把控件尽量设置成不透明的，如果是透明的会有什么影响，如何检测这种影响？为什么cell中的图片，尽可能要使用正确的大小、格式，如果错误会有什么影响，如何检测这种影响？为什么设置阴影和圆角有可能影响滑动时流畅度？shouldRasterize和离屏渲染的关系是什么，何时应该使用？本文会结合Instrument分析影响...">
  <meta property="wb:webmaster" content="294ec9de89e7fadb" />
  <meta property="qc:admins" content="104102651453316562112116375" />
  <meta property="qc:admins" content="11635613706305617" />
  <meta property="qc:admins" content="1163561616621163056375" />
  <meta name="google-site-verification" content="cV4-qkUJZR6gmFeajx_UyPe47GW9vY6cnCrYtCHYNh4" />
  <meta name="google-site-verification" content="HF7lfF8YEGs1qtCE-kPml8Z469e2RHhGajy6JPVy5XI" />
  <meta http-equiv="mobile-agent" content="format=html5; url=http://www.jianshu.com/p/619cf14640f3">
    <!--  Meta for Smart App Banner -->
  <meta name="apple-itunes-app" content="app-id=888237539, app-argument=jianshu://notes/2883448">
  <!-- End -->

  <!--  Meta for Twitter Card -->
  <meta content="summary" property="twitter:card">
  <meta content="@jianshucom" property="twitter:site">
  <meta content="UIKit性能调优实战讲解" property="twitter:title">
  <meta content="在使用UIKit的过程中，性能优化是永恒的话题。很多人都看过分析优化滑动性能的文章，但其中不少文章只介绍了优化方法却对背后的原理避而不谈，或者是晦涩难懂而且读者缺乏实践体验的机会。不妨思考一下下面的问题自己是否有一个清晰的认识：为什么要把控件尽量设置成不透明的，如果是透明的会有什么影响，如何检测这种影响？为什么cell中的图片，尽可能要使用正确的大小、格式，如果错误会有什么影响，如何检测这种影响？为什么设置阴影和圆角有可能影响滑动时流畅度？shouldRasterize和离屏渲染的关系是什么，何时应该使用？本文会结合Instrument分析影响..." property="twitter:description">
  <meta content="http://www.jianshu.com/p/619cf14640f3" property="twitter:url">
  <!-- End -->

  <!--  Meta for OpenGraph -->
  <meta property="fb:app_id" content="865829053512461">
  <meta property="og:site_name" content="简书">
  <meta property="og:title" content="UIKit性能调优实战讲解">
  <meta property="og:type" content="article">
  <meta property="og:url" content="http://www.jianshu.com/p/619cf14640f3">
  <meta property="og:description" content="在使用UIKit的过程中，性能优化是永恒的话题。很多人都看过分析优化滑动性能的文章，但其中不少文章只介绍了优化方法却对背后的原理避而不谈，或者是晦涩难懂而且读者缺乏实践体验的机会。不妨思考一下下...">
  <!-- End -->

  <!--  Meta for Facebook Applinks -->
  <meta property="al:ios:url" content="jianshu://notes/2883448" />
  <meta property="al:ios:app_store_id" content="888237539" />
  <meta property="al:ios:app_name" content="简书" />

  <meta property="al:android:url" content="jianshu://notes/2883448" />
  <meta property="al:android:package" content="com.jianshu.haruki" />
  <meta property="al:android:app_name" content="简书" />
  <!-- End -->

  <title>UIKit性能调优实战讲解 - 简书</title>
  <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="8AEITkvMYvfDAUzJC8xtXcFJwukVM36lfgtmx5GJvvZF6of0BzCZmWPMFuz2TjBXZUKL8lMKf+QrbZ1+8PypZg==" />
  <!--[if lte IE 8]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="stylesheet" media="all" href="http://cdn-qn0.jianshu.io/assets/base-00828532d00225531ad20ff45bf311ea.css" />

    <link rel="stylesheet" media="all" href="http://cdn-qn0.jianshu.io/assets/reading-note-31f4bce318acdaac0a693701a57737e3.css" />
  <link rel="stylesheet" media="all" href="http://cdn-qn0.jianshu.io/assets/base-read-mode-5f4051bc94fc595e8bc00821aae6c3e1.css" />
  <script src="http://cdn-qn0.jianshu.io/assets/modernizr-613ea63b5aa2f0e2a1946e9c28c8eedb.js"></script>
  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if IE 8]><link rel="stylesheet" media="all" href="http://cdn-qn0.jianshu.io/assets/scaffolding/for_ie-7f1c477ffedc13c11315103e8787dc6c.css" /><![endif]-->
  <!--[if lt IE 9]><link rel="stylesheet" media="all" href="http://cdn-qn0.jianshu.io/assets/scaffolding/for_ie-7f1c477ffedc13c11315103e8787dc6c.css" /><![endif]-->
  <link href="http://baijii-common.b0.upaiyun.com/icons/favicon.ico" rel="icon">
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/57-b426758a1fcfb30486f20fd073c3b8ec.png" sizes="57x57" />
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/72-feca4b183b9d29fd188665785dc7a7f1.png" sizes="72x72" />
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/76-ba757f1ad3421192ce7192170393d2b0.png" sizes="76x76" />
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/114-8dae53b3bcea3f06bb139e329d1edab3.png" sizes="114x114" />
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/120-fa315ee0177dba4c55d4f66d4129b47f.png" sizes="120x120" />
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/152-052f5799bec8fb3aa624bdc72ef5bd1d.png" sizes="152x152" />

</head>

<body class="post output zh cn mac reader-day-mode reader-font2" data-js-module="note-show" data-locale="zh-CN">
  
  <div class="navbar navbar-jianshu shrink">
  <div class="dropdown">
    <a class="dropdown-toggle logo" id="dLabel" role="button" data-toggle="dropdown" data-target="#" href="javascript:void(0)">
      简
    </a>
    <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
      <li><a href="/"><i class="fa fa-home"></i> 首页</a></li>
      <li><a href="/collections"><i class="fa fa-th"></i> 专题</a></li>
    </ul>
  </div>
</div>
<div class="navbar-user">
    <a class="app-download-btn" href="/apps/download?utm_medium=top-sugg-down&amp;utm_source=web-other-page">App下载</a>
    <a class="login" data-signup-link="true" data-toggle="modal" href="/sign_up">
      <i class="fa fa-user"></i> 注册
</a>    <a class="login" data-signin-link="true" data-toggle="modal" href="/sign_in">
      <i class="fa fa-sign-in"></i> 登录
</a>    <a class="daytime set-view-mode pull-right" href="javascript:void(0)"><i class="fa fa-moon-o"></i></a>
</div>
<div class="navbar navbar-jianshu expanded">
  <div class="dropdown">
      <a class="active logo" role="button" data-original-title="个人主页" data-container="div.expanded" href="/">
        <b>简</b><i class="fa fa-home"></i><span class="title">首页</span>
</a>      <a data-toggle="tooltip" data-placement="right" data-original-title="专题" data-container="div.expanded" href="/collections">
        <i class="fa fa-th"></i><span class="title">专题</span>
</a>    <a class="ad-selector" href="/apps">
      <i class="fa fa-mobile"></i><span class="title">下载手机应用</span>
</a>    <div class="ad-container ">
      <div class="ad-pop">
        <img class="ad-logo" src="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/228-0765f118055a1d942fc286fb55f37773.png" alt="228" />
        <p class="ad-title">简书</p>
        <p class="ad-subtitle">交流故事，沟通想法</p>
        <img class="ad-qrcode" src="http://cdn-qn0.jianshu.io/assets/app-page/download-app-qrcode-053849fa25f9b44573ef8dd3c118a20f.png" alt="Download app qrcode" />
        <div>
          <a class="ad-link" href="https://itunes.apple.com/cn/app/jian-shu/id888237539?ls=1&amp;mt=8">iOS</a>·
          <a class="ad-link" href="http://downloads.jianshu.io/apps/haruki/JianShu-1.11.4.apk">Android</a>
        </div>
      </div>
    </div>
  </div>
  <div class="nav-user">
      <a href='#view-mode-modal' data-toggle='modal'><i class="fa fa-font"></i><span class="title">显示模式</span></a>

      <a class="signin" data-signin-link="true" data-toggle="modal" data-placement="right" data-original-title="登录" data-container="div.expanded" href="/sign_in">
        <i class="fa fa-sign-in"></i><span class="title">登录</span>
</a>    </div>
  </div>

  
      <div class="popover-wrap">
       <div class="fixed-btn note-fixed-download" data-toggle="popover" data-placement="left" data-html="true" data-trigger="hover" data-content='<img src="http://cdn-qn0.jianshu.io/assets/app-page/note-qrcode-599086b03613e4f65dce8698fe9bcc99.png" alt="Note qrcode" />'>
        <a class="qrcode" href="javascript:void(0)">
          <img src="http://cdn-qn0.jianshu.io/assets/icon_qrcode-1f27688ec77df5a8c6c6ea70aa181874.png" alt="Icon qrcode" />
          <div>简书手机版下载</div>
</a>      </div>
    </div>
    <div class="fixed-btn">
      <a class="go-top hide-go-top" href="#"> <i class="fa fa-angle-up"></i></a>
      <a class="writer" href="/writer#/" data-toggle="tooltip" data-placement="left" title="写篇文章"><i class="fa fa-pencil"></i></a>
    </div>


  <div id="show-note-container">
    
<div class="post-bg" id="flag">
  <div class="wrap-btn">
    <!-- Notebook and collections button upper left -->
      <div class="article-related pull-left">
          <a class="collection-menu-btn" data-toggle="modal" data-target="#collection-menu" href="javascript:void(null);">
            <i class="fa fa-th"></i>
</a>          <a class="notebooks-menu-btn" data-toggle="modal" data-target="#notebooks-menu" href="javascript:void(null);"><i class="fa fa-list-ul"></i></a>
        <div class="related-avatar-group activities"></div>
      </div>
    <!-- ******* -->

      <a class="app-download-btn" href="/apps/download?utm_medium=top-sugg-down&amp;utm_source=note-show">App下载</a>
  <a class="login" data-signup-link="true" data-toggle="modal" href="/sign_up">
    <i class="fa fa-user"></i> 注册
</a>  <a class="login" data-signin-link="true" data-toggle="modal" href="/sign_in">
    <i class="fa fa-sign-in"></i> 登录
</a>

    <!-- Buttons upper right -->
    <!-- ******* -->
  </div>

  <div class="container">
    <!-- Article activities for width under 768px -->
    <div class="related-avatar-group activities"></div>
      <div class="article">
        <div class="preview">
          <div class="author-info">
              <div class="btn btn-small btn-success follow">
    <a data-signin-link="true" data-toggle="modal" href="/sign_in"><i class="fa fa-plus"></i>  <span>添加关注</span></a>
  </div>

            <a class="avatar" href="/users/3e55748920d2">
              <img src="http://upload.jianshu.io/users/upload_avatars/1171077/0acf478c97d1.jpg?imageMogr/thumbnail/90x90/quality/100" alt="100" />
</a>            <span class="label">
                作者
            </span>
            <a class="author-name blue-link" href="/users/3e55748920d2">
              <span>bestswifter</span>
</a>              <span data-toggle='tooltip' data-original-title='最后编辑于 2016.01.24 22:37'>2016.01.22 14:54*</span>
            <div>
              <span>写了222723字</span>，<span>被5801人关注</span>，<span>获得了4540个喜欢</span>
            </div>
          </div>
          <h1 class="title">UIKit性能调优实战讲解</h1>
          <div class="meta-top">
            <span class="wordage"></span>
            <span class="views-count"></span>
            <span class="comments-count"></span>
            <span class="likes-count"></span>
          </div>

          <!-- Collection/Bookmark/Share for width under 768px -->
          <div class="article-share"></div>
          <!-- -->

          <div class="show-content"><p>在使用UIKit的过程中，性能优化是永恒的话题。很多人都看过分析优化滑动性能的文章，但其中不少文章只介绍了优化方法却对背后的原理避而不谈，或者是晦涩难懂而且读者缺乏实践体验的机会。不妨思考一下下面的问题自己是否有一个清晰的认识：</p>
<ol>
<li>为什么要把控件尽量设置成不透明的，如果是透明的会有什么影响，如何检测这种影响？</li>
<li>为什么cell中的图片，尽可能要使用正确的大小、格式，如果错误会有什么影响，如何检测这种影响？</li>
<li>为什么设置阴影和圆角有可能影响滑动时流畅度？</li>
<li>
<code>shouldRasterize</code>和离屏渲染的关系是什么，何时应该使用？</li>
</ol>
<p>本文会结合Instrument分析影响性能的因素，提出优化方案并解释背后的原理，项目初始demo的下载地址在<a href="https://github.com/bestswifter/MySampleCode/tree/master/GraphicsPerformance-Starter" target="_blank">我的Github</a>，强烈建议每一位读者下载下来随着我一步一步调试、优化。如果觉得对自己有帮助，可以给一个Star表示支持。后面的图片较多，流量党慎入。</p>
<h1>基本概念</h1>
<p>打开项目后，只要CustomTableCell.swift文件即可，它实现了自定义的<code>UITableViewCell</code>以及内部的UI布局，因为重点在于性能优化，代码实现的就比较随意。</p>
<p>首先按下<code>Command + I</code>打开Instrument，本文主要用到的是Core Animation工具：</p>
<div class="image-package">
<img src="http://upload-images.jianshu.io/upload_images/1171077-ae80c7d848fc7b74.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/1171077-ae80c7d848fc7b74.png?imageMogr2/auto-orient/strip%7CimageView2/2"><br><div class="image-caption">打开Core Animation调试</div>
</div>
<p>注意这个调试必须使用真机，点击左上角的红色圆圈就会开始录制。新手可能不太熟悉，这里简单介绍一下调试界面：</p>
<div class="image-package">
<img src="http://upload-images.jianshu.io/upload_images/1171077-2d3291d97e7ffe99.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/1171077-2d3291d97e7ffe99.png?imageMogr2/auto-orient/strip%7CimageView2/2"><br><div class="image-caption">调试界面</div>
</div>
<p>我们需要了解两个两个区域：</p>
<ol>
<li>这里记录了实时的fps数值，有些地方是0是因为屏幕没有滑动</li>
<li>这是重中之重，接下来我会带大家逐个理解、体验这些调试选项</li>
</ol>
<p>有过游戏经验的人也许对<strong>fps</strong>这个概念比较熟悉。我们知道任何屏幕总是有一个刷新率，比如iphone推荐的刷新率是60Hz，也就是说GPU每秒钟刷新屏幕60次，因此两次刷新之间的间隔为16.67ms。这段时间内屏幕内容保持不变，称为<strong>一帧(frame)</strong>，fps表示<strong>frames per second</strong>，也就是每秒钟显示多少帧画面。对于静止不变的内容，我们不需要考虑它的刷新率，但在执行动画或滑动时，fps的值直接反映出滑动的流畅程度。</p>
<h1>调试、优化</h1>
<h3>图层混合</h3>
<p>首先我们要明白像素的概念，屏幕上每一个点都是一个像素，像素有R、G、B三种颜色构成(有时候还带有alpha值)。如果某一块区域上覆盖了多个layer,最后的显示效果受到这些layer的共同影响。举个例子，上层是蓝色(RGB=0,0,1),透明度为50%，下层是红色(RGB=1,0,0)。那么最终的显示效果是紫色(RGB=0.5,0,0.5)。这种颜色的混合(blending)需要消耗一定的GPU资源，因为实际上可能不止只有两层。如果只想显示最上层的蓝色，可以把它的透明度设置为100%，这样GPU会忽略下面所有的layer，从而节约了很多不必要的运算。</p>
<p>第一个调试选项"Color Blended Layers"正是用于检测哪里发生了图层混合，并用红色标记出来。因此我们需要尽可能减少看到的红色区域。一旦发现应该想法设法消除它。开始调试后勾选这个选项，我们在手机上可以看到如下的场景：</p>
<div class="image-package">
<img src="http://upload-images.jianshu.io/upload_images/1171077-6fb5ba7033c1f825.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/1171077-6fb5ba7033c1f825.png?imageMogr2/auto-orient/strip%7CimageView2/2"><br><div class="image-caption">Color Blended Layers</div>
</div>
<p>很多文章里说把控件设置为<code>opaque = true</code>，其原理就是希望避免图层混合，然而这种调优一般情况下用处不大。因为<code>UIView</code>的<code>opaque</code>属性默认值就是<code>true</code>，也就是说只要不是人为设置成透明，都不会出现图层混合。比如demo中就没有任何透明的控件。</p>
<p>对于<code>UIImageView</code>来说，不仅它自身需要是不透明的，它的图片也不能含有alpha通道，这就是为什么图中第三个图片是绿色，而前两个图片是红色的原因。由于本人对PS和图像几乎一窍不通，恕我不能演示如何消除这些图片的红色。我从网上找了一个美女的头像来说明，图像自身的性质可能会对结果有影响，因此如果你确定自己的代码没有问题，而且出现了图层混合，请联系美工或后台解决。</p>
<p>个人认为比<code>opaque</code>属性更重要的是<code>backgroundColor</code>属性，如果不设置这个属性，控件依然被认为是透明的，所以我们做的第一个优化是在<code>CustomTableCell</code>类的<code>init</code>方法中添加一行代码：</p>
<pre><code>label.backgroundColor = UIColor.whiteColor()</code></pre>
<p>虽然在白色背景下，这行代码无法肉眼看到效果，但重新调试后我们可以发现label的红色消失了。也正是因为对背景颜色的不重视，它成了影响滑动性能的第一个杀手。</p>
<p>PS：如果label文字有中文，依然会出现图层混合，这是因为此时label多了一个<code>sublayer</code>，如果有好的解决办法欢迎告诉我。</p>
<h3>光栅化</h3>
<p>光栅化是将一个layer预先渲染成位图(bitmap)，然后加入缓存中。如果对于阴影效果这样比较消耗资源的静态内容进行缓存，可以得到一定幅度的性能提升。demo中的这一行代码表示将label的layer光栅化：</p>
<pre><code class="swift">label.layer.shouldRasterize = true</code></pre>
<p>Instrument中，第二个调试选项是“Color Hits Green and Misses Red”，它表示如果命中缓存则显示为绿色，否则显示为红色，显然绿色越多越好，红色越少越好。勾选这个选项后我们看到如下的场景：</p>
<div class="image-package">
<img src="http://upload-images.jianshu.io/upload_images/1171077-7d6dcd41fe0d6a72.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/1171077-7d6dcd41fe0d6a72.png?imageMogr2/auto-orient/strip%7CimageView2/2"><br><div class="image-caption">Color Hits Green and Misses Red</div>
</div>
<p>光栅化的核心在于缓存的思想。我们自己动手把玩一下，可以发现以下几个有意思的现象：</p>
<ol>
<li>上下微小幅度滑动时，一直是绿色</li>
<li>上下较大幅度滑动，新出现的label一开始是红色，随后变成绿色</li>
<li>如果静止一秒钟，刚开始滑动时会变红。</li>
</ol>
<p>这是因为layer进行光栅化后渲染成位图放在缓存中。当屏幕出现滑动时，我们直接从缓存中读取而不必渲染，所以会看到绿色。当新的label出现时，缓存中没有个这个label的位图，所以会变成红色。第三点比较关键，缓存中的对象有效期只有100ms，即如果在0.1s内没有被使用就会自动从缓存中清理出去。这就是为什么停留一会儿再滑动就会看到红色。</p>
<p>光栅化的缓存机制是一把双刃剑，先写入缓存再读取有可能消耗较多的时间。因此光栅化仅适用于较复杂的、静态的效果。通过Instrument的调试发现，这里使用光栅化经常出现未命中缓存的情况，如果没有特殊需要则可以关闭光栅化，所以我们做的第二个优化是注释掉下面这行代码：</p>
<pre><code class="swift">//    label.layer.shouldRasterize = true</code></pre>
<p>光栅化会导致离屏渲染，这一点待会儿会讲。</p>
<h3>颜色格式</h3>
<p>像素在内存中的布局和它在磁盘中的存储方式并不相同。考虑一种简单的情况：每个像素有R、G、B和alpha四个值，每个值占用1字节，因此每个像素占用4字节的内存空间。一张1920*1080的照片(iPhone6 Plus的分辨率)一共有2,073,600个像素，因此占用了超过8Mb的内存。但是一张同样分辨率的PNG格式或JPEG格式的图片一般情况下不会有这么大。这是因为JPEG将像素数据进行了一种非常复杂且可逆的转化。</p>
<p>当我们打开JPEG格式的图片时，CPU会进行一系列运算，将JPEG图片解压成像素数据。显然这个工作会消耗不少时间，所以不应该在滑动时进行，我们应该预先处理好图片。借用WWDC上的一页PPT来说明：</p>
<div class="image-package">
<img src="http://upload-images.jianshu.io/upload_images/1171077-0386edf0d24b7099.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/1171077-0386edf0d24b7099.png?imageMogr2/auto-orient/strip%7CimageView2/2"><br><div class="image-caption">显示流程</div>
</div>
<p>Commit Transaction和Decode在同一帧内进行，如果这两个操作的耗时超过16.67s，Draw Calls就会延迟到下一帧，从而导致fps值的降低。下面是Commit Transaction的详细流程：</p>
<div class="image-package">
<img src="http://upload-images.jianshu.io/upload_images/1171077-5f115f552ca219ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/1171077-5f115f552ca219ad.png?imageMogr2/auto-orient/strip%7CimageView2/2"><br><div class="image-caption">解码与转换</div>
</div>
<p>在第三步的Prepare中，CPU主要处理两件事：</p>
<ol>
<li>把图片从PNG或JPEG等格式中解压出来，得到像素数据</li>
<li>如果GPU不支持这种颜色各式，CPU需要进行格式转换</li>
</ol>
<p>比如应用中有一些从网络下载的图片，而GPU恰好不支持这个格式，这就需要CPU预先进行格式转化。第三个选项“Color Copied Images”就用来检测这种实时的格式转化，如果有则会将图片标记为蓝色。</p>
<p>遗憾的是由于我对图片格式不太了解，也不会使用相关工具，并没有能模拟出触发这个选项的场景。我们要记住的是，如果调试时发现有图片被标记为蓝色，说明图片格式出现了一些问题。</p>
<h3>图片大小</h3>
<p>第四个选项的使用场景不多，我们直接看一下第五个选项“Color Misaligned Images”。它表示如果图片需要缩放则标记为黄色，如果没有像素对齐则标记为紫色。勾选上这个选项并进行调试，可以看到如下场景：</p>
<div class="image-package">
<img src="http://upload-images.jianshu.io/upload_images/1171077-c6226861bea907a9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/1171077-c6226861bea907a9.png?imageMogr2/auto-orient/strip%7CimageView2/2"><br><div class="image-caption">图片缩放</div>
</div>
<p>在demo中，每个<code>UIImageView</code>的大小都是180x180，而只有第二张图片的像素大小是360x360。因此除了第二张图片，其他的图片都需要被缩放。图片的缩放需要占用时间，因此我们要尽可能保证无论是本地图片还是从网络或取得图片的大小，都与其frame保持一致。</p>
<p>第三个优化是调整所有图片的像素大小以避免不必要的缩放。</p>
<h3>离屏渲染</h3>
<p>离屏渲染表示渲染发生在屏幕之外，你可能认为这是一句废话。为了真正解释清楚什么是离屏渲染，我们先来看一下正常的渲染通道(Render-Pass)：</p>
<div class="image-package">
<img src="http://upload-images.jianshu.io/upload_images/1171077-e22bfaff8314b6d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/1171077-e22bfaff8314b6d6.png?imageMogr2/auto-orient/strip%7CimageView2/2"><br><div class="image-caption">正常渲染通道</div>
</div>
<p>首先，OpenGL提交一个命令到Command Buffer，随后GPU开始渲染，渲染结果放到Render Buffer中，这是正常的渲染流程。但是有一些复杂的效果无法直接渲染出结果，它需要分步渲染最后再组合起来，比如添加一个蒙版(mask)：</p>
<div class="image-package">
<img src="http://upload-images.jianshu.io/upload_images/1171077-551823de77e0e04e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/1171077-551823de77e0e04e.png?imageMogr2/auto-orient/strip%7CimageView2/2"><br><div class="image-caption">离屏渲染</div>
</div>
<p>在前两个渲染通道中，GPU分别得到了纹理(texture，也就是那个相机图标)和layer(蓝色的蒙版)的渲染结果。但这两个渲染结果没有直接放入Render Buffer中，也就表示这是离屏渲染。直到第三个渲染通道，才把两者组合起来放入Render Buffer中。离屏渲染意味着把渲染结果临时保存，等用到时再取出，因此相对于普通渲染更占用资源。</p>
<p>第六个选项“Color Offscreen-Rendered Yellow”会把需要离屏渲染的地方标记为黄色，大部分情况下我们需要尽可能避免黄色的出现。离屏渲染可能会自动触发，也可以手动触发。以下情况可能会导致触发离屏渲染：</p>
<blockquote><ol>
<li>重写drawRect方法</li>
<li>有mask或者是阴影(layer.masksToBounds, layer.shadow*)，模糊效果也是一种mask</li>
<li>layer.shouldRasterize = true</li>
</ol></blockquote>
<p>前两者会自动触发离屏渲染，第三种方法是手动开启离屏渲染。</p>
<p>开始调试并勾选“Color Offscreen-Rendered Yellow”，会看到这样的场景：</p>
<div class="image-package">
<img src="http://upload-images.jianshu.io/upload_images/1171077-84a9318793df9d5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/1171077-84a9318793df9d5a.png?imageMogr2/auto-orient/strip%7CimageView2/2"><br><div class="image-caption">离屏渲染</div>
</div>
<p>如果没有进行第二步优化，你会发现label也是黄色。可以看到tabbar和statusBar也是黄色，这是因为它们使用了模糊效果。图片也是黄色，这说明它也进行了离屏渲染，观察源码后发现主要原因是它使用了阴影，接下来我们进行第四个优化，在设置阴影效果的四行代码下面添加一行：</p>
<pre><code class="swift">imgView.layer.shadowPath = UIBezierPath(rect: imgView.bounds).CGPath</code></pre>
<p>这行代码制定了阴影路径，如果没有手动指定，Core Animation会去自动计算，这就会触发离屏渲染。如果人为指定了阴影路径，就可以免去计算，从而避免产生离屏渲染。</p>
<p>设置<code>cornerRadius</code>本身并不会导致离屏渲染，但很多时候它还需要配合<code>layer.masksToBounds = true</code>使用。根据之前的总结，设置<code>masksToBounds</code>会导致离屏渲染。解决方案是尽可能在滑动时避免设置圆角，如果必须设置圆角，可以使用光栅化技术将圆角缓存起来：</p>
<pre><code class="swift">// 设置圆角
label.layer.masksToBounds = true
label.layer.cornerRadius = 8
label.layer.shouldRasterize = true
label.layer.rasterizationScale = layer.contentsScale</code></pre>
<h3>快速路径</h3>
<p>还记得之前将离屏渲染和渲染路径时的示意图么，离屏渲染的最后一步是把此前的多个路径组合起来。如果这个组合过程能由CPU完成，就会大量减少GPU的工作。这种技术在绘制地图中可能用到。</p>
<p>第七个选项“Color Compositing Fast-Path Blue”用于标记由硬件绘制的路径，蓝色越多越好。</p>
<h3>变化区域</h3>
<p>刷新视图时，我们应该把需要重绘的区域尽可能缩小。对于未发生变化的内容则不应该重绘，第八个选项“Flash updated Regions”用于标记发生重绘的区域。一个典型的例子是系统的时钟应用，绝大多数时候只有显示秒针的区域需要重绘：</p>
<div class="image-package">
<img src="http://upload-images.jianshu.io/upload_images/1171077-2092b1b15b094025.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/1171077-2092b1b15b094025.png?imageMogr2/auto-orient/strip%7CimageView2/2"><br><div class="image-caption">重绘区域</div>
</div>
<h1>总结</h1>
<p>如果你一步一步做到了这里，我想一定会有不少收益。不过，学而不思则罔，思而不学则殆。动手实践后还是应该总结提炼，优化滑动性能主要涉及三个方面：</p>
<h3>避免图层混合</h3>
<ol>
<li>确保控件的<code>opaque</code>属性设置为<code>true</code>，确保<code>backgroundColor</code>和父视图颜色一致且不透明</li>
<li>如无特殊需要，不要设置低于1的<code>alpha</code>值</li>
<li>确保<code>UIImage</code>没有alpha通道</li>
</ol>
<h3>避免临时转换</h3>
<ol>
<li>确保图片大小和<code>frame</code>一致，不要在滑动时缩放图片</li>
<li>确保图片颜色格式被GPU支持，避免劳烦CPU转换</li>
</ol>
<h3>慎用离屏渲染</h3>
<ol>
<li>绝大多数时候离屏渲染会影响性能</li>
<li>重写<code>drawRect</code>方法，设置圆角、阴影、模糊效果，光栅化都会导致离屏渲染</li>
<li>设置阴影效果是加上阴影路径</li>
<li>滑动时若需要圆角效果，开启光栅化</li>
</ol>
<h3>实战</h3>
<p>本文的demo可以在<a href="https://github.com/bestswifter/MySampleCode/tree/master/GraphicsPerformance-Starter" target="_blank">我的Github</a>上下载，然后一步一步自己体验优化过程。但demo毕竟是刻意搭建的一个环境，我会在我自己的仿写的<a href="https://github.com/WL201314/MJianshu" target="_blank">简书app</a>上不断进行实战优化，欢迎共同学习交流。</p>
<h1>参考资料：</h1>
<ol>
<li>
<a href="http://objccn.io/issue-3-1/" target="_blank">绘制像素到屏幕上</a>，原文：<a href="https://www.objc.io/issues/3-views/" target="_blank">Getting Pixels onto the Screen</a>
</li>
<li>
<a href="https://developer.apple.com/videos/play/wwdc2014-419/" target="_blank">Advanced Graphics and Animations for iOS Apps</a>：这是2014年WWDC Session 419，强烈建议看一遍。</li>
<li><a href="http://oncenote.com/2015/12/08/How-to-build-UI/" target="_blank">如何正确地写好一个界面</a></li>
<li><a href="https://yalantis.com/blog/mastering-uikit-performance/" target="_blank">Mastering UIKit Performance</a></li>
</ol>
<p>还有一些高质量的问答：</p>
<ol>
<li><a href="http://stackoverflow.com/questions/6302029/what-triggers-color-copied-images-and-color-hits-green-and-misses-red-in-ins" target="_blank">What triggers “Color Copied Images” and “Color Hits Green and Misses Red” in Instruments?</a></li>
<li><a href="http://stackoverflow.com/questions/34895641/uilabel-is-marked-as-red-when-color-blended-layers-is-selected" target="_blank">UILabel is marked as red when <code>Color Blended Layers</code> is selected</a></li>
<li><a href="http://stackoverflow.com/questions/13158796/what-triggers-offscreen-rendering-blending-and-layoutsubviews-in-ios" target="_blank">What triggers offscreen rendering, blending and layoutSubviews in iOS?</a></li>
</ol>
</div>
        </div>
      </div>

      <div class="visitor_edit">
        <!-- further readings -->
        <div id="further-readings" data-user-slug="" data-user-nickname="">
          <div id="further-reading-line" class="hide further-reading-line"></div>
          <ul id="further-readings-list" class="reading-list unstyled"></ul>
          <div id="further-reading-new" class="reading-edit">
              <a data-signin-link="true" data-toggle="modal" href="/sign_in">
                <i class="fa fa-plus-circle"></i> 推荐拓展阅读
</a>            <div id="further-reading-form"></div>
          </div>
        </div>
        <div class="pull-right">
          <!-- copyright -->
          <div class="author-copyright pull-right" data-toggle="tooltip" data-html="true" title="转载请联系作者获得授权，并标注“简书作者”。">
            <a><i class="fa fa-copyright"></i> 著作权归作者所有</a>
          </div>
        </div>
      </div>

      <!-- Reward / Support Author -->
        <div class="support-author">
          <p>如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作！</p>
            <a class="btn btn-pay" data-toggle="modal" href="#pay-modal">¥ 打赏支持</a>
          <div class="avatar-list"></div>
        </div>

      <!-- article meta bottom -->
      <div class="meta-bottom clearfix">
        <!--  Like Button -->
        <div class="like ">
            <div class="like-button">
              <a id="like-note" class="like-content" data-signin-link="true" data-toggle="modal" href="/sign_in">
                <i class="fa fa-heart-o"></i>  喜欢
</a></div>          <span id="likes-count" data-toggle="tooltip" data-placement="right" title="查看所有喜欢的用户">
            <i class="fa fa-spinner fa-pulse"></i>
</span>        </div>
        <!--  share group -->
        <div class="share-group pull-right">
          <a href="javascript:void((function(s,d,e,r,l,p,t,z,c){var%20f=&#39;http://v.t.sina.com.cn/share/share.php?appkey=1881139527&#39;,u=z||d.location,p=[&#39;&amp;url=&#39;,e(u),&#39;&amp;title=&#39;,e(t||d.title),&#39;&amp;source=&#39;,e(r),&#39;&amp;sourceUrl=&#39;,e(l),&#39;&amp;content=&#39;,c||&#39;gb2312&#39;,&#39;&amp;pic=&#39;,e(p||&#39;&#39;)].join(&#39;&#39;);function%20a(){if(!window.open([f,p].join(&#39;&#39;),&#39;mb&#39;,[&#39;toolbar=0,status=0,resizable=1,width=440,height=430,left=&#39;,(s.width-440)/2,&#39;,top=&#39;,(s.height-430)/2].join(&#39;&#39;)))u.href=[f,p].join(&#39;&#39;);};if(/Firefox/.test(navigator.userAgent))setTimeout(a,0);else%20a();})(screen,document,encodeURIComponent,&#39;&#39;,&#39;&#39;,&#39;http://cwb.assets.jianshu.io/notes/images/2883448/weibo/image_fd183b9dc1cc.jpg&#39;, &#39;推荐 @bestswifter 的文章《UIKit性能调优实战讲解》（ 分享自 @简书 ）&#39;,&#39;http://www.jianshu.com/p/619cf14640f3&#39;,&#39;页面编码gb2312|utf-8默认gb2312&#39;));" data-name="weibo">
            <i class="fa fa-weibo"></i><span>分享到微博</span>
          </a>
          <a data-toggle="modal" href="#share-weixin-modal" data-name="weixin">
            <i class="fa fa-weixin"></i><span>分享到微信</span>
          </a>
          <div class="more">
            <a href="javascript:void(0)" data-toggle="dropdown">更多分享<i class="fa fa-caret-down"></i></a>
            <ul class="dropdown-menu arrow-top">
                <li><a href="http://cwb.assets.jianshu.io/notes/images/2883448/weibo/image_fd183b9dc1cc.jpg" target="_blank" data-name="changweibo"><i class="fa fa-arrow-circle-o-down"></i> 下载长微博图片</a></li>
                <li>
                  <a data-name="tweibo" href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;http://share.v.t.qq.com/index.php?c=share&amp;a=index&amp;url=&#39;+e(&#39;http://www.jianshu.com/p/619cf14640f3&#39;)+&#39;&amp;title=&#39;+e(&#39;推荐 bestswifter 的文章《UIKit性能调优实战讲解》（ 分享自 @jianshuio ）&#39;),x=function(){if(!window.open(r,&#39;tweibo&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();">
                    <img src="http://baijii-common.b0.upaiyun.com/social_icons/32x32/tweibo.png" alt="Tweibo" /> 分享到腾讯微博
</a>                </li>
                <li>
                  <a data-name="qzone" href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=&#39;+e(&#39;http://www.jianshu.com/p/619cf14640f3&#39;)+&#39;&amp;title=&#39;+e(&#39;推荐 bestswifter 的文章《UIKit性能调优实战讲解》&#39;),x=function(){if(!window.open(r,&#39;qzone&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();">
                    <img src="http://baijii-common.b0.upaiyun.com/social_icons/32x32/qzone.png" alt="Qzone" /> 分享到QQ空间
</a>                </li>
                <li>
                  <a data-name="twitter" href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;https://twitter.com/share?url=&#39;+e(&#39;http://www.jianshu.com/p/619cf14640f3&#39;)+&#39;&amp;text=&#39;+e(&#39;推荐 bestswifter 的文章《UIKit性能调优实战讲解》（ 分享自 @jianshucom ）&#39;)+&#39;&amp;related=&#39;+e(&#39;jianshucom&#39;),x=function(){if(!window.open(r,&#39;twitter&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();">
                    <img src="http://baijii-common.b0.upaiyun.com/social_icons/32x32/twitter.png" alt="Twitter" /> 分享到Twitter
</a>                </li>
                <li>
                  <a data-name="facebook" href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;https://www.facebook.com/dialog/share?app_id=483126645039390&amp;display=popup&amp;href=http://www.jianshu.com/p/619cf14640f3&#39;,x=function(){if(!window.open(r,&#39;facebook&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();">
                    <img src="http://baijii-common.b0.upaiyun.com/social_icons/32x32/facebook.png" alt="Facebook" /> 分享到Facebook
</a>                </li>
                <li>
                  <a data-name="google_plus" href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;https://plus.google.com/share?url=&#39;+e(&#39;http://www.jianshu.com/p/619cf14640f3&#39;),x=function(){if(!window.open(r,&#39;google_plus&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();">
                    <img src="http://baijii-common.b0.upaiyun.com/social_icons/32x32/google_plus.png" alt="Google plus" /> 分享到Google+
</a>                </li>
                <li>
                  <a data-name="douban" href="javascript:void(function(){var d=document,e=encodeURIComponent,s1=window.getSelection,s2=d.getSelection,s3=d.selection,s=s1?s1():s2?s2():s3?s3.createRange().text:&#39;&#39;,r=&#39;http://www.douban.com/recommend/?url=&#39;+e(&#39;http://www.jianshu.com/p/619cf14640f3&#39;)+&#39;&amp;title=&#39;+e(&#39;UIKit性能调优实战讲解&#39;)+&#39;&amp;sel=&#39;+e(s)+&#39;&amp;v=1&#39;,x=function(){if(!window.open(r,&#39;douban&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330&#39;))location.href=r+&#39;&amp;r=1&#39;};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})()">
                    <img src="http://baijii-common.b0.upaiyun.com/social_icons/32x32/douban.png" alt="Douban" /> 分享到豆瓣
</a>                </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Modals -->
      <div id="share-weixin-modal" class="modal hide fade share-weixin-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
  </div>
  <div class="modal-body">
    <h5>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</h5>
  </div>
</div>

      
      <div id="notebooks-menu" class="panel notebooks-menu arrow-top modal hide fade"><img class="loader-tiny" src="http://baijii-common.b0.upaiyun.com/loaders/tiny.gif" alt="Tiny" /></div>
      <div id="collection-menu" class="panel collection-menu arrow-top modal hide fade"><img class="loader-tiny" src="http://baijii-common.b0.upaiyun.com/loaders/tiny.gif" alt="Tiny" /></div>
      
      <div id="likes-modal" class="modal modal_new support_list-modal fullscreen hide fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3>喜欢的用户</h3>
      </div>
      <div class="modal-body">
        <ul class="unstyled users">
        </ul>
      </div>
    </div>
  </div>
</div>



    <!-- Comments -->
    <div id="comments" class="comment-list clearfix">
        <div class="comment-head clearfix">
          76条评论
          <span class="order">
            （
            <a data-order="asc" class="active" href="javascript:void(0)">按时间正序</a>·
            <a data-order="desc" href="javascript:void(0)">按时间倒序</a>·
            <a data-order="likes_count" href="javascript:void(0)">按喜欢排序</a>
            ）
          </span>
            <a class="goto-comment pull-right" data-signin-link="true" data-toggle="modal" href="/sign_in">
              <i class="fa fa-pencil"></i>添加新评论
</a>        </div>
        <div id="comment-list">
          <img class="loader-tiny" src="http://baijii-common.b0.upaiyun.com/loaders/tiny.gif" alt="Tiny" />
        </div>
          <p class="signout-comment">
    <a class="btn btn-info" data-signin-link="true" data-toggle="modal" href="/sign_in">
      登录后发表评论
</a>  </p>

    </div>
    <!-- -->

  </div>

  <script type='application/json' data-name='note'>
    {"id":2883448,"abbr":"在使用UIKit的过程中，性能优化是永恒的话题。很多人都看过分析优化滑动性能的文章，但其中不少文章只介绍了优化方法却对背后的原理避而不谈，或者是晦涩难懂而且读者缺乏实践体验的机会。不妨思考一下下面的问题自己是否有一个清晰的认识：为什么要把控件尽量设置成不透明的，如果是透明的会有什么影响，如何检测这种影响？为什么cell中的图片，尽可能要使用正确的大小、格式，如果错误会有什么影响，如何检测这种影响？为什么设置阴影和圆角有可能影响滑动时流畅度？shouldRasterize和离屏渲染的关系是什么，何时应该使用？本文会结合Instrument分析影响...","slug":"619cf14640f3","url":"http://www.jianshu.com/p/619cf14640f3","image_url":"http://cwb.assets.jianshu.io/notes/images/2883448/weibo/image_fd183b9dc1cc.jpg","wordage":4042,"has_further_readings":false,"views_count":20117,"likes_count":267,"comments_count":76,"rewards_total_count":2}
  </script>

  <script type='application/json' data-name='uuid'>
    {"uuid":"0d6831e7-00f2-42bc-bb3d-8e128ac73040"}
  </script>

  <script type='application/json' data-name='author'>
    {"id":1171077,"nickname":"bestswifter","slug":"3e55748920d2","public_notes_count":89,"followers_count":5801,"total_likes_count":4540,"is_current_user":false,"is_signed_author":false}
  </script>


    <div class="include-collection">
      <div class="content">
        <h5>被以下专题收入，发现更多相似内容：</h5>
        <ul id="all-collections" class="unstyled collections-list">
            <li>
              <a class="avatar" href="/collection/V2CqjW"><img src="http://upload.jianshu.io/collections/images/14/6249340_194140034135_2.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/180" alt="180" /></a>              <div class="collections-info">
                <h5>
                  <a href="/collection/V2CqjW">@IT·互联网</a>
                </h5>
                
  <div class="btn btn-success follow">
    <a data-signin-link="true" data-toggle="modal" href="/sign_in"><i class="fa fa-fw fa-plus"></i>  <span>添加关注</span></a>
    <span>190.4K</span>
  </div>

                <p class="description">@IT 专题 由 IT大分类，转定位于IT·互联网行业观察与思考，数码产品极客体验。

主编：向右奔跑 http://www.ji...</p>
                <p>
                  <a class="blue-link" href="/collection/V2CqjW">10949篇文章</a> · 190472人关注
                </p>
              </div>
            </li>
            <li>
              <a class="avatar" href="/collection/3233d1a249ca"><img src="http://upload.jianshu.io/collections/images/1276/162902612251cbd95971b82.png?imageMogr2/auto-orient/strip|imageView2/2/w/180" alt="180" /></a>              <div class="collections-info">
                <h5>
                  <a href="/collection/3233d1a249ca">iOS Developer</a>
                </h5>
                
  <div class="btn btn-success follow">
    <a data-signin-link="true" data-toggle="modal" href="/sign_in"><i class="fa fa-fw fa-plus"></i>  <span>添加关注</span></a>
    <span>27.9K</span>
  </div>

                <p class="description">分享 iOS 开发的知识，解决大家遇到的问题，讨论iOS开发的前沿，欢迎大家投稿~</p>
                <p>
                  <a class="blue-link" href="/collection/3233d1a249ca">14855篇文章</a> · 27973人关注
                </p>
              </div>
            </li>
            <li>
              <a class="avatar" href="/collection/19dbe28002a3"><img src="http://upload.jianshu.io/collections/images/6919/c4409daa19d59b1950bf3bed66a49495.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/180" alt="180" /></a>              <div class="collections-info">
                <h5>
                  <a href="/collection/19dbe28002a3">iOS开发技巧</a>
                </h5>
                
  <div class="btn btn-success follow">
    <a data-signin-link="true" data-toggle="modal" href="/sign_in"><i class="fa fa-fw fa-plus"></i>  <span>添加关注</span></a>
    <span>21.1K</span>
  </div>

                <p class="description"> 【简介】
专题内容主要包括OC、swift等涉及到iOS开发进阶的内容。
swift可以关注下我的另一个专题：
swift开发...</p>
                <p>
                  <a class="blue-link" href="/collection/19dbe28002a3">1058篇文章</a> · 21196人关注
                </p>
              </div>
            </li>
        </ul>
      </div>
    </div>

  <!-- Modal -->
    <div class="modal pay-modal text-center hide fade" id="pay-modal">
  <div class="modal-header clearfix">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
  </div>
  <form id="new_reward" class="new_reward" target="_blank" action="/notes/2883448/rewards" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="RuoyKPcfAV/hwviLYl2PsdzfdBhpGnxbs45dITjsSNbzAb2Su+P6MUEPoq6f39K7eNQ9Ay8jfRrm6KaYWZlfRg==" />
    <div class="modal-body">
      <a href="/users/3e55748920d2">
        <div class="avatar"><img src="http://upload.jianshu.io/users/upload_avatars/1171077/0acf478c97d1.jpg?imageMogr/thumbnail/90x90/quality/100" alt="100" /></div>
</a>      <p><i class="fa fa-quote-left pull-left"></i>如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作！<i class="fa fa-quote-right pull-right"></i></p>
      <div class="main-inputs text-left">
        <div class="control-group">
          <label for="reward_amount">打赏金额</label><i class="fa fa-yen"></i>
          <input value="2.00" type="text" name="reward[amount_in_yuan]" id="reward_amount_in_yuan" />
        </div>
        <div class="control-group message">
          <textarea placeholder="给Ta留言" name="reward[message]" id="reward_message">
</textarea>
        </div>
      </div>
      <div class="choose-pay text-left">
        <h5>选择支付方式：</h5>
        <div>
          <label for="reward_channel_alipay">
            <input type="radio" value="alipay" checked="checked" name="reward[channel]" id="reward_channel_alipay" />
            <span class="alipay-bg"></span>
</label>
          
          <label for="reward_channel_wx_pub_qr">
            <input type="radio" value="wx_pub_qr" name="reward[channel]" id="reward_channel_wx_pub_qr" />
            微信支付
</label>        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button name="button" type="submit" class="btn btn-large btn-pay">立即支付</button>
    </div>
</form></div>

    <div class="modal success-pay text-center hide fade" id="success-pay">
  <div class="modal-header clearfix">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
  </div>
  <div class="modal-body">
    <h3><i class="icon-ok"></i>打赏成功</h3>
    <img src="http://cdn-qn0.jianshu.io/assets/complete-pay-25426877089eb23bd76d9d0e6aad89c1.png" alt="Complete pay" />
  </div>
  <div class="modal-footer">
    
  </div>
</div>

</div>

  </div>
  <div id="flash" class="hide"></div>
  
  <div id="view-mode-modal" tabindex="-1" class="modal hide read-modal" aria-hidden="false" data-js-module='view-mode-modal'>
    <div class="btn-group change-background" data-toggle="buttons-radio">
      <a class="btn btn-daytime active" data-mode="day" href="javascript:void(null);">
        <i class="fa fa-sun-o"></i>
</a>      <a class="btn btn-nighttime " data-mode="night" href="javascript:void(null);">
        <i class="fa fa-moon-o"></i>
</a>    </div>
    <div class="btn-group change-font" data-toggle="buttons-radio">
      <a class="btn font " data-font="font1" href="javascript:void(null);">宋体</a>
      <a class="btn font hei active" data-font="font2" href="javascript:void(null);">黑体</a>
    </div>
    <div class="btn-group change-locale" data-toggle="buttons-radio">
      <a class="btn font active" data-locale="zh-CN" href="javascript:void(null);">简</a>
      <a class="btn font hei " data-locale="zh-TW" href="javascript:void(null);">繁</a>
    </div>
  </div>

  

  <script src="http://cdn-qn0.jianshu.io/assets/base-ded41764c207f7ff545c28c670922d25.js"></script>
  
  <script src="http://cdn-qn0.jianshu.io/assets/reading-base-0028299ec0c770293c0f07e2f338b48f.js"></script>
  <script src="http://cdn-qn0.jianshu.io/assets/reading/module_sets/note_show-cc5c20512664aad53acca20308dd4d1c.js"></script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-35169517-1', 'auto');
  ga('send', 'pageview');
</script>

<div style="display:none">
  <script src="https://s11.cnzz.com/z_stat.php?id=1258679142&web_id=1258679142" language="JavaScript"></script>
</div>

<script>
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
</script>

</body>
</html>
